define("rests",["jquery","text!models/restList.json.txt","utils"],function(e,t,n){function i(){return t}function r(n,i){i=i||t;var r=e.grep(i,function(t){for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];if("string"==typeof t.verticals[i]){if(r!=t.verticals[i])return!1}else if("object"==typeof t.verticals[i]&&t.verticals[i].length&&-1==e.inArray(r,t.verticals[i]))return!1}return!0});return r}return t=JSON.parse(t)[n.i18n.getLanguage()],{fetch:i,filter:r}}),define("questions",["text!models/questionsList.json.txt","utils"],function(e,t){function n(){return e}return e=JSON.parse(e)[t.i18n.getLanguage()],{fetch:n}}),define("story",["text!models/story.json.txt","utils"],function(e,t){return e=JSON.parse(e)[t.i18n.getLanguage()]}),function(e){"function"==typeof define&&define.amd?define("plugins",["jquery"],e):e(jQuery)}(function(e){var t=e;t.extend(t.easing,{easeOutBack:function(e,t,n,i,r,o){return void 0==o&&(o=.8),i*((t=t/r-1)*t*((o+1)*t+o)+1)+n},easeOutQuad:function(e,t,n,i,r){return-i*(t/=r)*(t-2)+n}}),t.fn.yotyper=function(e,n){function i(e){return function(t){var n=a.html();a.html("").html(n+e),setTimeout(t,o.animDelay)}}var r={animDelay:30},o=t.extend(r,e),a=t(this);n=n||t(this),t.each(o.text.split(""),function(e,t){n.queue(i(t))})},function(e){function t(e){return"object"==typeof e?e:{top:e,left:e}}var n=e.scrollTo=function(t,n,i){e(window).scrollTo(t,n,i)};n.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},n.window=function(){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||-1!=e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!n)return t;var i=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||"BackCompat"==i.compatMode?i.body:i.documentElement})},e.fn.scrollTo=function(i,r,o){return"object"==typeof r&&(o=r,r=0),"function"==typeof o&&(o={onAfter:o}),"max"==i&&(i=9e9),o=e.extend({},n.defaults,o),r=r||o.duration,o.queue=o.queue&&o.axis.length>1,o.queue&&(r/=2),o.offset=t(o.offset),o.over=t(o.over),this._scrollable().each(function(){function a(e){c.animate(d,r,o.easing,e&&function(){e.call(this,i,o)})}if(null!=i){var s,l=this,c=e(l),u=i,d={},p=c.is("html,body");switch(typeof u){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(u)){u=t(u);break}if(u=e(u,this),!u.length)return;case"object":(u.is||u.style)&&(s=(u=e(u)).offset())}e.each(o.axis.split(""),function(e,t){var i="x"==t?"Left":"Top",r=i.toLowerCase(),f="scroll"+i,h=l[f],m=n.max(l,t);if(s)d[f]=s[r]+(p?0:h-c.offset()[r]),o.margin&&(d[f]-=parseInt(u.css("margin"+i))||0,d[f]-=parseInt(u.css("border"+i+"Width"))||0),d[f]+=o.offset[r]||0,o.over[r]&&(d[f]+=u["x"==t?"width":"height"]()*o.over[r]);else{var g=u[r];d[f]=g.slice&&"%"==g.slice(-1)?parseFloat(g)/100*m:g}o.limit&&/^\d+$/.test(d[f])&&(d[f]=0>=d[f]?0:Math.min(d[f],m)),!e&&o.queue&&(h!=d[f]&&a(o.onAfterFirst),delete d[f])}),a(o.onAfter)}}).end()},n.max=function(t,n){var i="x"==n?"Width":"Height",r="scroll"+i;if(!e(t).is("html,body"))return t[r]-e(t)[i.toLowerCase()]();var o="client"+i,a=t.ownerDocument.documentElement,s=t.ownerDocument.body;return Math.max(a[r],s[r])-Math.min(a[o],s[o])}}(e)}),define("text!tmpl/questions-tmpl.html",[],function(){return'{{#questions}}\r\n\r\n<article id="question{{id}}" class="questionArticle" data-vertical="{{vertical}}" data-ga-name="{{gaName}}">\r\n    <div class="questionBox question">{{text}}</div>\r\n    <div class="questionBox answers">\r\n        <ul>\r\n            {{#answers}}\r\n            <li data-value="{{value}}">{{text}}</li>\r\n            {{/answers}}\r\n        </ul>\r\n    </div>\r\n</article>\r\n\r\n{{/questions}}'}),define("vendor/add2home",["utils"],function(e){var t={he:"he_il",en:"en_us"},n={expire:10080,lifespan:15e3,message:t[e.i18n.getLanguage()]||"he_il"},i=function(e,t){function n(){if(S){var n,r=Date.now();if(t)for(n in t)L[n]=t[n];L.autostart||(L.hookOnLoad=!1),p=/ipad/gi.test(T.platform),f=e.devicePixelRatio&&e.devicePixelRatio>1,h=/Safari/i.test(T.appVersion)&&!/CriOS/i.test(T.appVersion),m=T.standalone,g=T.appVersion.match(/OS (\d+_\d+)/i),g=g&&g[1]?+g[1].replace("_","."):0,M=+e.localStorage.getItem("addToHome"),b=e.sessionStorage.getItem("addToHomeSession"),j=L.returningVisitor?M&&M+24192e5>r:!0,M||(M=r),v=j&&r>=M,L.hookOnLoad?e.addEventListener("load",i,!1):!L.hookOnLoad&&L.autostart&&i()}}function i(){if(e.removeEventListener("load",i,!1),j?L.expire&&v&&e.localStorage.setItem("addToHome",Date.now()+6e4*L.expire):e.localStorage.setItem("addToHome",Date.now()),y||h&&v&&!b&&!m&&j){var t="",n=T.platform.split(" ")[0],o=T.language.replace("-","_");w=document.createElement("div"),w.id="addToHomeScreen",w.style.cssText+="left:-9999px;-webkit-transition-property:-webkit-transform,opacity;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);position:"+(5>g?"absolute":"fixed"),L.message in E&&(o=L.message,L.message=""),""===L.message&&(L.message=o in E?E[o]:E.en_us),L.touchIcon&&(t=f?document.querySelector('head link[rel^=apple-touch-icon][sizes="114x114"],head link[rel^=apple-touch-icon][sizes="144x144"],head link[rel^=apple-touch-icon]'):document.querySelector('head link[rel^=apple-touch-icon][sizes="57x57"],head link[rel^=apple-touch-icon]'),t&&(t='<span style="background-image:url('+t.href+')" class="addToHomeTouchIcon"></span>')),w.className=(p?"addToHomeIpad":"addToHomeIphone")+(t?" addToHomeWide":""),w.innerHTML=t+L.message.replace("%device",n).replace("%icon",g>=4.2?'<span class="addToHomeShare"></span>':'<span class="addToHomePlus">+</span>')+(L.arrow?'<span class="addToHomeArrow"></span>':"")+(L.closeButton?'<span class="addToHomeClose">×</span>':""),document.body.appendChild(w),L.closeButton&&w.addEventListener("click",s,!1),!p&&g>=6&&window.addEventListener("orientationchange",d,!1),setTimeout(r,L.startDelay)}}function r(){var t,n=208;if(p)switch(5>g?(q=e.scrollY,C=e.scrollX):6>g&&(n=160),w.style.top=q+L.bottomOffset+"px",w.style.left=C+n-Math.round(w.offsetWidth/2)+"px",L.animationIn){case"drop":t="0.6s",w.style.webkitTransform="translate3d(0,"+-(e.scrollY+L.bottomOffset+w.offsetHeight)+"px,0)";break;case"bubble":t="0.6s",w.style.opacity="0",w.style.webkitTransform="translate3d(0,"+(q+50)+"px,0)";break;default:t="1s",w.style.opacity="0"}else switch(q=e.innerHeight+e.scrollY,5>g?(C=Math.round((e.innerWidth-w.offsetWidth)/2)+e.scrollX,w.style.left=C+"px",w.style.top=q-w.offsetHeight-L.bottomOffset+"px"):(w.style.left="50%",w.style.marginLeft=-Math.round(w.offsetWidth/2)-(e.orientation%180&&g>=6?40:0)+"px",w.style.bottom=L.bottomOffset+"px"),L.animationIn){case"drop":t="1s",w.style.webkitTransform="translate3d(0,"+-(q+L.bottomOffset)+"px,0)";break;case"bubble":t="0.6s",w.style.webkitTransform="translate3d(0,"+(w.offsetHeight+L.bottomOffset+50)+"px,0)";break;default:t="1s",w.style.opacity="0"}w.offsetHeight,w.style.webkitTransitionDuration=t,w.style.opacity="1",w.style.webkitTransform="translate3d(0,0,0)",w.addEventListener("webkitTransitionEnd",l,!1),k=setTimeout(a,L.lifespan)}function o(e){S&&!w&&(y=e,i())}function a(){if(clearInterval(x),clearTimeout(k),k=null,w){var t=0,n=0,i="1",r="0";switch(L.closeButton&&w.removeEventListener("click",s,!1),!p&&g>=6&&window.removeEventListener("orientationchange",d,!1),5>g&&(t=p?e.scrollY-q:e.scrollY+e.innerHeight-q,n=p?e.scrollX-C:e.scrollX+Math.round((e.innerWidth-w.offsetWidth)/2)-C),w.style.webkitTransitionProperty="-webkit-transform,opacity",L.animationOut){case"drop":p?(r="0.4s",i="0",t+=50):(r="0.6s",t+=w.offsetHeight+L.bottomOffset+50);break;case"bubble":p?(r="0.8s",t-=w.offsetHeight+L.bottomOffset+50):(r="0.4s",i="0",t-=50);break;default:r="0.8s",i="0"}w.addEventListener("webkitTransitionEnd",l,!1),w.style.opacity=i,w.style.webkitTransitionDuration=r,w.style.webkitTransform="translate3d("+n+"px,"+t+"px,0)"}}function s(){e.sessionStorage.setItem("addToHomeSession","1"),b=!0,a()}function l(){return w.removeEventListener("webkitTransitionEnd",l,!1),w.style.webkitTransitionProperty="-webkit-transform",w.style.webkitTransitionDuration="0.2s",k?(5>g&&k&&(x=setInterval(c,L.iterations)),void 0):(w.parentNode.removeChild(w),w=null,void 0)}function c(){var t=new WebKitCSSMatrix(e.getComputedStyle(w,null).webkitTransform),n=p?e.scrollY-q:e.scrollY+e.innerHeight-q,i=p?e.scrollX-C:e.scrollX+Math.round((e.innerWidth-w.offsetWidth)/2)-C;(n!=t.m42||i!=t.m41)&&(w.style.webkitTransform="translate3d("+i+"px,"+n+"px,0)")}function u(){e.localStorage.removeItem("addToHome"),e.sessionStorage.removeItem("addToHomeSession")}function d(){w.style.marginLeft=-Math.round(w.offsetWidth/2)-(e.orientation%180&&g>=6?40:0)+"px"}var p,f,h,m,g,v,b,j,w,y,x,k,T=e.navigator,S="platform"in T&&/iphone|ipod|ipad/gi.test(T.platform),C=0,q=0,M=0,L={autostart:!0,returningVisitor:!0,animationIn:"drop",animationOut:"fade",startDelay:2e3,lifespan:15e3,bottomOffset:14,expire:0,message:"",touchIcon:!0,arrow:!0,hookOnLoad:!0,closeButton:!0,iterations:100},E={en_us:"Always be ready for tonight: tap %icon and then <strong>Add to Home Screen</strong>.",he_il:'<span dir="rtl" style="text-align:right;display:inline-block">תמיד מוכנים להערב:<br/>לחצו %icon ואז <strong>הוסף למסך הבית</strong>.</span>'};return n(),{show:o,close:a,reset:u}}(window,n);return i}),define("view",["jquery","plugins","utils","text!tmpl/questions-tmpl.html","vendor/add2home"],function(e,t,n,i){function r(){window.onorientationchange=function(){window.scrollTo(0,1),x()},e(window).on("resize",function(){x()}),e(document).on("click","#questions li",l).on("questionShown",function(t,i){n.log("[VIEW]","on questionShown",arguments),n.log("[VIEW]","on questionShown","1st q id:",E.find(".questionArticle").first().attr("id").replace("question","")),i==E.find(".questionArticle").first().attr("id").replace("question","")?(n.log("[VIEW]","on questionShown","hiding"),P.fadeOut(),H.hide(),a(),n.isSmallScreen()&&e("#languageSelectionWrapper").fadeIn(),Q.fadeIn()):(n.log("[VIEW]","on questionShown","showing"),P.fadeIn(),o(),n.isSmallScreen()?(e("#languageSelectionWrapper").fadeOut(),Q.fadeOut()):H.show())}),O.on("click",y),F.on("click",v),I.on("click",j),V.on("click",b),$.on("click",y),W.on("click",function(){return n.ga.trackEvent("results","click_rest_name",e(this).data("rest-name")),!0})}function o(){n.isSmallScreen()||L.slideDown("fast")}function a(){n.isSmallScreen()||L.slideUp("fast")}function s(){L=e("header"),E=e("#questions"),H=e("#restCountContent"),B=e("#restCount"),D=e("#restCountLabel"),A=e("#story"),P=e("#btnBackContainer"),O=e("#btnBack"),I=e("#btnRestart"),X=e("#restInfo"),W=e("#restLink"),N=e("#restName"),R=e("#restPhoneLink"),z=e("#restPhone"),U=e("#restAddressLink"),_=e("#restAddress"),F=e("#btnPrevRest"),V=e("#btnNextRest"),G=e("#noRestsLeft"),$=e("#noRestsLeftBack"),Y=e("#restTip"),Q=e("footer")}function l(){var t=e(this),i=t.parents("article"),r=t.data("value"),o=i.data("vertical"),a=i.data("ga-name");n.log("[VIEW]","onAnswerClicked","vertical:",o,"answer:",r),n.ga.trackEvent(a,""==r?"no":r),S.onUserSelection(o,r)}function c(e){var t=parseInt(B.html())||0;t!=e&&B.stop().animate({count:e},{duration:800,easing:"easeOutQuad",step:function(e){B.html(Math.round(e))},complete:function(){B.html(e)}})}function u(t){if(t){var n=e("<span class='chapter'></span>");e("#storyCursor").before(n),n.yotyper({text:t},A)}}function d(e){A.stop(!1,!0);var t=e?A.children("span.chapter"):A.children("span.chapter").last();t.remove()}function p(t){x("#question"+t),t&&e(document).trigger("questionShown",t)}function f(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),i-=1,t=e[i],e[i]=e[n],e[n]=t;return e}function h(e){q=f(e),M=0,1==q.length?(V.hide(),F.hide()):(V.show(),F.show()),B.stop(),H.stop().fadeOut(),x("#results"),g()}function m(e){N.html(e.name).blur(),z.html(e.phone),_.html(e.address),W.attr("href",e.url).data("rest-name",e.gaName),n.isMobile()&&(U.attr("href","http://maps.apple.com/?q=israel, Tel aviv, "+e.address),R.attr("href","tel:"+e.phone))}function g(){var t=q[M].info;n.ga.trackEvent("results","show_rest",t.gaName),X.stop().animate({opacity:0},{duration:100,complete:function(){m(t),X.stop().animate({opacity:1},700)}}),n.isSmallScreen()||Y.stop().animate({opacity:0},{duration:100,complete:function(){e(this).html(t.tip).stop().animate({opacity:1},700)}})}function v(){n.ga.trackEvent("results","click","prev"),M--,0>M&&(M=q.length-1),g()}function b(){n.ga.trackEvent("results","click","next"),M++,M==q.length&&(M=0),g()}function j(){n.ga.trackEvent("btnRestart","click",e(C).data("ga-name")),S.reset()}function w(){G.fadeIn()}function y(){n.ga.trackEvent(e(this).attr("id"),"click",e(C).data("ga-name")),G.fadeOut(),S.onBack()}function x(e){C=e||C,E.stop().scrollTo(C,{duration:1e3,easing:"easeOutBack"})}function k(){e("html").attr("dir",n.i18n.getDirection());var t=n.i18n.getStaticTexts();for(var i in t){var r=e("#"+i);r.length||(r=e("."+i)),r.length&&r.html(t[i])}O.attr("title",t.btnBackTitle),F.attr("title",t.btnPrevRestTitle),I.attr("title",t.btnRestartTitle),V.attr("title",t.btnNextRestTitle),n.i18n.languageSelector.init()}function T(t,o){n.log("[VIEW]","init"),S=t;var a=n.mustache.to_html(i,{questions:o});e("#questions .placeholder").first().after(a),s(),r(),k(),!navigator.userAgent.match(/iPhone/i)&&!navigator.userAgent.match(/iPod/i)||window.navigator.standalone||e("#restCountWrapper").addClass("iphone"),window.scrollTo(0,1),e(".hidden").removeClass("hidden")}var S,C,q,M,L,E,H,B,D,A,P,O,I,X,W,N,R,z,U,_,Y,F,V,G,$,Q;return{init:T,displayQuestion:p,updateRestCount:c,addStoryChapter:u,removeStoryChapter:d,noRestsLeft:w,displayResults:h}}),define("history",[],function(){function e(e,t,n){i||(i=[]),i.push({currentQuestionIndex:e,restList:t,userSelection:$.extend({},n)})}function t(){return i.pop()}function n(){i=[]}var i;return{save:e,restore:t,reset:n}}),define("dinnerclub",["jquery","rests","questions","story","view","history","utils"],function(e,t,n,i,r,o,a){function s(e,n){if(o.save(v,m,h),""==n)return d(),u(),void 0;var r={};r[e]=h[e]=n,m=t.filter(r,m),m.length?d():c(),u(i[e][n])}function l(){if(0!=v){var e=o.restore();e&&(v=e.currentQuestionIndex,m=e.restList,h=e.userSelection,b||r.removeStoryChapter(),u())}}function c(){a.ga.trackEvent("noRestsLeft","view",JSON.stringify(h)),r.noRestsLeft()}function u(e){a.log("[DinnerClub]","updateView","currentQuestionIndex:",v,"userSelection:",h,"restList:",m),v==g.length?r.displayResults(m):(r.updateRestCount(m.length),r.displayQuestion(g[v].id)),e&&!b&&r.addStoryChapter(e)}function d(){for(;g[++v]&&h[g[v].vertical];);}function p(){v=0,h={},m=t.fetch(),o.reset(),r.removeStoryChapter(!0),u()}function f(){g=n.fetch(),r.init(this,g),p(),a.isSmallScreen()?a.log("[DinnerClub]","*** No About"):(a.log("[DinnerClub]","*** Fetching About..."),require(["./about"],function(e){a.log("[DinnerClub]","*** About Loaded, initing..."),e.init()})),a.ga.trackEvent("init",a.isMobile()?"mobile":"desktop",a.i18n.getLanguage())}var h,m,g,v,b=!1;return{init:f,onUserSelection:s,onBack:l,reset:p}}),require.config({baseUrl:"scripts/",paths:{jquery:"http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min",models:"../models",tmpl:"../tmpl",style:"../style",text:"libs/text",mustache:"libs/mustache.min",plugins:"libs/plugins.min",mousewheel:"libs/jquery.mousewheel.min",jscrollpane:"libs/jquery.jscrollpane.min",view:"view"}}),require(["dinnerclub","utils"],function(e,t){$(function(){e.init(),t.log("DinnerClub ON")})}),define("main",function(){});